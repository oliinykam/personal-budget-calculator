<div class="container">
  <div class="filters">
    <div class="filter-group">
      <label>Time Period</label>
      <select [(ngModel)]="selectedPeriod" (ngModelChange)="updateReports()">
        <option value="month">This Month</option>
        <option value="lastMonth">Last Month</option>
        <option value="3months">Last 3 Months</option>
        <option value="6months">Last 6 Months</option>
        <option value="year">This Year</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Report Type</label>
      <select [(ngModel)]="reportType">
        <option value="all">All Reports</option>
        <option value="income">Income Analysis</option>
        <option value="expense">Expense Analysis</option>
        <option value="category">Category Breakdown</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Export</label>
      <button class="btn btn-primary" style="width: 100%;" (click)="openPdfPreview()">ðŸ“„ Export PDF</button>
    </div>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <h3>Average Monthly Income</h3>
      <div class="amount income-color">${{ avgIncome.toFixed(2) }}</div>
      <div class="change">Based on selected period</div>
    </div>
    <div class="stat-card">
      <h3>Average Monthly Expenses</h3>
      <div class="amount expense-color">${{ avgExpenses.toFixed(2) }}</div>
      <div class="change">Based on selected period</div>
    </div>
    <div class="stat-card">
      <h3>Savings Rate</h3>
      <div class="amount savings-color">{{ savingsRate }}%</div>
      <div class="change">{{ getSavingsMessage() }}</div>
    </div>
  </div>

  <div class="charts-grid">
    <div class="chart-card">
      <h2>ðŸ“Š Monthly Comparison</h2>
      <div class="bar-chart">
        <div class="chart-bars">
          <div *ngFor="let month of monthlyData" class="bar-group">
            <div class="bar-container">
              <div class="bar income-bar" [style.height.%]="(month.income / maxMonthlyValue) * 100">
                <span class="bar-label" *ngIf="month.income > 0">${{ month.income }}</span>
              </div>
              <div class="bar expense-bar" [style.height.%]="(month.expenses / maxMonthlyValue) * 100">
                <span class="bar-label" *ngIf="month.expenses > 0">${{ month.expenses }}</span>
              </div>
            </div>
            <div class="bar-month">{{ month.month }}</div>
          </div>
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-color income-bg"></span>
            <span>Income</span>
          </div>
          <div class="legend-item">
            <span class="legend-color expense-bg"></span>
            <span>Expenses</span>
          </div>
        </div>
      </div>
    </div>

    <div class="chart-card">
      <h2>ðŸŽ¯ Expense Distribution</h2>
      <div class="pie-chart">
        <div *ngFor="let category of categoryData; let i = index" class="category-row">
          <div class="category-info">
            <span class="category-dot" [style.background-color]="getCategoryColor(i)"></span>
            <span class="category-name">{{ category.label }}</span>
          </div>
          <div class="category-bar-container">
            <div 
              class="category-bar" 
              [style.width.%]="(category.value / totalExpenses) * 100"
              [style.background-color]="getCategoryColor(i)">
            </div>
          </div>
          <span class="category-value">${{ category.value }} ({{ ((category.value / totalExpenses) * 100).toFixed(0) }}%)</span>
        </div>
      </div>
    </div>
  </div>

  <div class="chart-card full-width">
    <h2>ðŸ“ˆ Balance Trend</h2>
    <div class="line-chart">
      <div class="chart-grid">
        <div *ngFor="let point of trendData; let i = index" class="trend-point">
          <div class="trend-line-container">
            <div 
              class="trend-bar" 
              [style.height.%]="(point.value / maxTrendValue) * 100"
              [ngClass]="{'positive': point.value > 0, 'negative': point.value < 0}">
            </div>
          </div>
          <div class="trend-label">{{ point.label }}</div>
          <div class="trend-value">${{ point.value }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="insights-section">
    <h2>ðŸ’¡ Financial Insights</h2>
    <div class="insights-grid">
      <div class="insight-card" [ngClass]="getInsightClass('spending')">
        <div class="insight-icon">{{ getInsightIcon('spending') }}</div>
        <div class="insight-content">
          <h3>Spending Trend</h3>
          <p>{{ getSpendingInsight() }}</p>
        </div>
      </div>
      <div class="insight-card" [ngClass]="getInsightClass('savings')">
        <div class="insight-icon">{{ getInsightIcon('savings') }}</div>
        <div class="insight-content">
          <h3>Savings Goal</h3>
          <p>{{ getSavingsInsight() }}</p>
        </div>
      </div>
      <div class="insight-card" [ngClass]="getInsightClass('budget')">
        <div class="insight-icon">{{ getInsightIcon('budget') }}</div>
        <div class="insight-content">
          <h3>Budget Status</h3>
          <p>{{ getBudgetInsight() }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="pdf-overlay" *ngIf="showPdfPreview" (click)="closePdfPreview()">
  <div class="pdf-modal" (click)="$event.stopPropagation()">
    <div class="pdf-toolbar">
      <span>Preview Mode</span>
      <div class="pdf-actions">
        <button class="btn btn-secondary btn-small" (click)="closePdfPreview()">Close</button>
        <button class="btn btn-primary btn-small" (click)="downloadPdf()">â¬‡ Download</button>
      </div>
    </div>
    
    <div class="pdf-paper">
      <div class="pdf-header">
        <h1>Financial Report</h1>
        <p>Generated on: {{ currentDate | date:'mediumDate' }}</p>
      </div>
      
      <div class="pdf-section">
        <h3>Summary ({{ selectedPeriod }})</h3>
        <div class="pdf-row">
          <span>Total Income:</span>
          <span class="income-text">+${{ avgIncome.toFixed(2) }}</span>
        </div>
        <div class="pdf-row">
          <span>Total Expenses:</span>
          <span class="expense-text">-${{ avgExpenses.toFixed(2) }}</span>
        </div>
        <div class="pdf-row highlight">
          <span>Savings Rate:</span>
          <span>{{ savingsRate }}%</span>
        </div>
      </div>

      <div class="pdf-section">
        <h3>Expense Breakdown</h3>
        <table class="pdf-table">
          <thead>
            <tr>
              <th>Category</th>
              <th align="right">Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of categoryData">
              <td>{{ item.label }}</td>
              <td align="right">${{ item.value }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pdf-footer">
        <p>Personal Budget Calculator Â© 2025</p>
      </div>
    </div>
  </div>
</div>